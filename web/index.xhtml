<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:p="http://primefaces.org/ui">
    <h:body>
        <ui:composition template="template/siteTemplate.xhtml">
            <!-- Page title -->
            <title><ui:define name="title">StreetSmart</ui:define></title>
            <!-- Additional CSS styles needed -->
            <ui:define name="css">
                <link rel="stylesheet" type="text/css" href="resources/css/index.css" />
                <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/ui-lightness/jquery-ui.min.css"/>
                <link rel="stylesheet" type="text/css" href="resources/css/dialog.css" />
            </ui:define>
            <!-- Additional JS files needed -->
            <ui:define name="js">
                <script type="text/javascript" src="resources/js/jquery-dotdotdot.js"></script>
                <script type="text/javascript" src="resources/js/index.js"></script>
                <script type="text/javascript" src="resources/js/pins.js"></script>
                <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
                <script type="text/javascript" src="resources/js/dialog.js"></script>
            </ui:define>

            <!-- Page content -->
            <ui:define name="editableContent">
                <!-- Map menu -->
                <div id="map-menu">
                    <!-- Very top -->
                    <div id="map-menu-title">Search and filters</div>
                    <img id="map-menu-close" src="resources/images/menu-hide.png" alt="Close Menu" />
                    <!-- Change location -->
                    <input id="map-menu-change-loc" class="input-control" type="text" placeholder="Change map location"/>
                    <button id="map-menu-change-loc-btn">
                        <img src="resources/images/change-loc.png" />
                    </button>
                    <!-- Clear + divider -->
                    <div style="clear: both"></div>
                    <hr class="map-menu-divider" />
                    <!-- Sort drop down -->
                    <div id="map-menu-sort-filter">
                        <h:form id="selectfilterForm">                           
                            Sort pins by: 
                            <h:selectOneMenu id="map-menu-sort-select" class="input-control" value="#{pinManager.filterOption}">
                                <f:selectItem itemValue="pop" itemLabel="Popularity" />
                                <f:selectItem itemValue="new" itemLabel="Newest" />
                                <f:selectItem itemValue="dist" itemLabel="Distance" />                                                            
                                <f:ajax render=":filterForm :map-menu-pins-list-form"/>
                            </h:selectOneMenu>
                        </h:form>
                    </div>
                    <!-- Filter by keyword -->
                    <h:inputText id="map-menu-filter-keyword" class="input-control" style="display: none"/>          
                    <!-- Distance check box -->
                    <div id="map-menu-distance-filter">                       
                        <h:form id="filterForm" style="#{pinManager.distanceFilterStyle}">
                            Only show pins within
                            <h:inputText id="map-menu-distance-input" class="input-control"  
                                   value="#{pinManager.filterDistanceStr}" />                           
                            miles
                            <h:commandButton id="filterBtn" style="display: none">
                                <f:ajax execute="@form" render="@form"/>
                            </h:commandButton>
                        </h:form>
                    </div>
                    <br/>
                    <!-- Listed pins -->
                    <div id="map-menu-pins-list">
                        <h:form id="map-menu-pins-list-form">
                            <ui:repeat value="#{pinManager.mapMenuPins}" var="pin">
                                <div class="pins-list-pin-wrapper">                              
                                    <div class="pins-list-pin-text-wrapper">
                                        <div class="pins-list-pin-title">
                                            <h:outputText value="#{pin.title}"/>
                                        </div>
                                        <div class="pins-list-pin-desc">
                                            <h:outputText value="#{pin.description}"/>
                                        </div>
                                    </div>
                                    <div class="pins-list-pin-img-wrapper">
                                        <img class="pins-list-pin-img" src="resources/images/profile-picture-2.png" alt="" />
                                    </div>
                                    <div class="pins-list-pin-view">View full pin</div>
                                    <div class="pins-list-pin-date">
                                        &nbsp;&nbsp;&bull;&nbsp;&nbsp;<h:outputText value="#{pinManager.getFormattedDate(pin)}"/>&nbsp;&nbsp;&bull;&nbsp;&nbsp;
                                    </div>
                                    <div class="pins-list-pin-votes">
                                        <h:outputText value="#{pin.upvotes - pin.downvotes} points"/>
                                    </div>   
                                </div>
                                
                                <hr class="pins-list-pin-divider"/>
                            </ui:repeat>
                            <h:commandButton id="filterPinsByDistance" style="display: none" action="#{pinManager.filterByDistance()}">
                                <f:ajax execute="@form" render="@form"/>
                            </h:commandButton>
                        </h:form>
                    </div>
                    <!-- End of listed pins area -->
                        
                    <!-- Pin details goes over the other menu items when displayed -->
                    <div id="map-menu-full-pin">
                        <img id="full-pin-close" src="resources/images/close.png" alt="Close Menu"/>
                        <div id="full-pin-top-wrapper">
                            <div id="full-pin-vote-wrapper">
                                <img id="full-pin-upvote" src="resources/images/upvote.png" alt="Upvote" />
                                <div id="full-pin-votes">12</div>
                                <img id="full-pin-downvote" src="resources/images/downvote.png" alt="Downvote" />
                            </div>
                            <img id="full-pin-pic" src="resources/images/profile-picture-2.png" alt="Pin Picture"/>
                        </div>
                        <div id="full-pin-title">Free ice cream!</div>
                        <div id="full-pin-desc">From now (1:00pm) until 6:00 tonight there is free ice cream on the drillfield! Come get it.</div>
                        <div id="full-pin-details">By Jared Schwalbe on Mar 11, 2016</div>
                        <hr class="full-pin-divider" />
                        <!-- Comments -->
                        <div id="full-pin-comments-wrapper">
                            <h:form id="comment">
                                <h:inputTextarea id="full-pin-post-comment" 
                                                 class="input-control #{component.valid?'':'validation-failed'}"
                                                 a:placeholder="Write your comment..." required="true" 
                                                 value="#{commentsManager.comment}"/>
                                <h:commandButton id="full-pin-post-comment-btn" class="btn" value="Post Comment" />
                            </h:form>
      
                            <div id="full-pin-comments-list">
                                <ui:repeat value="#{commentsManager.getCommentsList()}" var="comment">
                                <div id="full-pin-comment">
                                    <div id="full-pin-comment-msg"><h:outputText value="#{comment.getComment()}"/></div>
                                    <div id="full-pin-comment-date"><h:outputText value="#{commentsManager.getFormattedDate(comment)}"/></div>
                                </div>
                                
                                <hr class="full-pin-comment-divider" />
                
                                </ui:repeat>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map overlays (ordered from highest z-index to lowest)-->
                <div id="map-loading"></div>
                <img id="show-menu" src="resources/images/menu-show.png" alt="Show Menu"/>
                <div class="add-pin-button"></div>
                <div id="map-message-wrapper">
                    <div id="map-message"></div> <!-- Gets centered inside parent -->
                </div>
                <img id="hidden-add-pin-hover" src="resources/images/add-pin-hover.png" alt=""/> <!-- preload hover img -->

                <!-- Contains the user's current location as "[lat] [long]" -->
                <h:form id="hidden">
                    <h:inputHidden id="userLocationHidden"                                   
                                   value="#{accountManager.userLoc}" />
                    <h:commandButton id="hiddenSubmit" style="display: none">
                        <f:ajax execute="@form" render="@form"/>
                    </h:commandButton>                   
                </h:form>
                <h:form id="hidden-comment">
                    <h:inputHidden id="commentInput" value="#{commentsManager.selectedPinId}" />
                    <h:commandButton id="commentSubmit" style="display: none" onclick="#{commentsManager.createComment()}">
                        <f:ajax execute="@form" render="@form"/>
                    </h:commandButton>
                </h:form>

                <!-- Map -->
                <div id="map"></div>

                <!-- Map js -->
                <script type="text/javascript" src="resources/js/map.js"></script>
                <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUFqUfsRLDfd4kVe4wYkACPu9Aswm0AT0&amp;callback=initialize" async="async" defer="defer"></script>

                <!-- Enter location dialog -->
                <div id="enter-loc-dialog" title="Enter Your Location">
                    <h:form id="enter-loc-form" enctype="multipart/form-data">
                        <!-- Create pin form -->
                        <div id="enter-loc-fields-wrapper">
                            <div id="enter-loc-message">
                                We had some trouble getting your location. Please enter your approximate address below.
                            </div>
                            <!-- Field -->
                            <h:inputText id="loc" class="input-control #{component.valid?'':'validation-failed'}" 
                                         a:placeholder="Ex: 1000 Main St, Blacksburg, VA" required="true" />
                        </div>
                        <!-- Divider -->
                        <hr style="margin: 15px 0 15px 0" />
                        <!-- Continue button -->
                        <h:commandButton id="continue-btn" class="btn" value="Continue" 
                                         onclick="enterLocSubmit()">
                            <f:ajax execute="@form" render="@form"/>
                        </h:commandButton>
                    </h:form>
                </div>

                <!-- Add pin dialog -->
                <div id="create-pin-dialog" title="Create a Pin at Your Location">
                    <h:form id="create-pin-form" enctype="multipart/form-data">
                        <!-- Create pin form -->
                        <div id="create-pin-fields-wrapper">
                            <!-- Fields -->
                            <h:inputText id="title" class="input-control #{component.valid?'':'validation-failed'}" 
                                         value="#{pinManager.pinTitle}" a:placeholder="Pin Title*"
                                         required="true" />
                            <h:inputTextarea id="description" class="input-control #{component.valid?'':'validation-failed'}"
                                             value="#{pinManager.pinDescription}" a:placeholder="Pin Description*"
                                             required="true" />
                            Upload photo (optional):
                            <p:fileUpload id="browse-btn" value="#{pinManager.file}" mode="simple" fileLimit="1" />
                            <h:selectBooleanCheckbox id="anonymous" value="#{pinManager.pinAnonymous}" /> Make anonymous
                        </div>
                        <!-- Divider -->
                        <hr style="margin: 15px 0 15px 0" />
                        <!-- Upload / close button -->
                        <h:commandButton id="cancel-btn" class="btn" value="Cancel" 
                                         onclick="closeDialogs()">
                            <f:ajax execute="@form" render="@form"/>
                        </h:commandButton>
                        <h:commandButton id="create-btn" class="btn" value="Create Pin" action="#{pinManager.createPin()}">
                            <f:ajax execute="@form" render="@form"/>8
                        </h:commandButton>
                    </h:form>
                </div>
            </ui:define>
        </ui:composition>
        <br />
        <h:link outcome="/photo/List" value="Show All Photo Items"/>
        <br />
        <h:link outcome="/user/List" value="Show All User Items"/>
    </h:body>


</html>
