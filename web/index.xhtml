<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:p="http://primefaces.org/ui">
    <h:body>
        <ui:composition template="template/siteTemplate.xhtml">
            <!-- Page title -->
            <title><ui:define name="title">StreetSmart</ui:define></title>
            <h:outputStylesheet name="css/jsfcrud.css"/>
            <!-- Additional CSS styles needed -->
            <ui:define name="css">
                <link rel="stylesheet" type="text/css" href="resources/css/index.css" />
                <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/ui-lightness/jquery-ui.min.css"/>
                <link rel="stylesheet" type="text/css" href="resources/css/dialog.css" />
            </ui:define>
            <!-- Additional JS files needed -->
            <ui:define name="js">
                <script type="text/javascript" src="resources/js/index.js"></script>
                <script type="text/javascript" src="resources/js/pins.js"></script>
                <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"/>
                <script type="text/javascript" src="resources/js/dialog.js"></script>
            </ui:define>

            <!-- Page content -->
            <ui:define name="editableContent">
                <!-- Map menu -->
                <div id="map-menu">
                    <!-- Very top -->
                    <div id="map-menu-title">Search and filters</div>
                    <img id="map-menu-close" src="resources/images/menu-hide.png" alt="Close Menu" />
                    <!-- Change location -->
                    <input id="map-menu-change-loc" class="input-control" type="text" placeholder="Change your location"/>
                    <button id="map-menu-change-loc-btn">
                        <img src="resources/images/change-loc.png" />
                    </button>
                    <!-- Clear + divider -->
                    <div style="clear: both"></div>
                    <hr class="map-menu-divider" />
                    <!-- Filter by keyword -->
                    <input id="map-menu-filter-keyword" class="input-control" type="text" placeholder="Filter pins by keyword"/>
                    <!-- Sort drop down -->
                    <div id="map-menu-sort-filter">
                        Sort pins by: 
                        <select id="map-menu-sort-select" class="input-control">
                            <option value="distance">Distance</option>
                            <option value="newest">Newest</option>
                            <option value="popular">Popular</option>
                        </select>
                    </div>
                    <!-- Distance check box -->
                    <div id="map-menu-distance-filter">
                        <input id="map-menu-distance-checkbox" type="checkbox" />
                        Only show pins within 
                        <input id="map-menu-distance-input" class="input-control" type="text" value="5" /> 
                        miles
                    </div>
                    <!-- Listed pins -->
                    <div id="map-menu-pins-list">
                        
                    </div>
                    
                    <!-- Pin details goes over the other menu items when displayed -->
                    <div id="map-menu-pin">
                        <img id="map-menu-pin-close" src="resources/images/close.png" alt="Close Menu"/>
                        <img id="map-menu-pin-pic" src="" alt="Pin Picture"/>
                        <div id="map-menu-pin-message"></div>
                    </div>
                </div>

                <!-- Map overlays (ordered from highest z-index to lowest)-->
                <div id="map-loading"></div>
                <img id="show-menu" src="resources/images/menu-show.png" alt="Show Menu"/>
                <div class="add-pin-button"></div>
                <div id="map-message-wrapper">
                    <div id="map-message"></div> <!-- Gets centered inside parent -->
                </div>
                <img id="hidden-add-pin-hover" src="resources/images/add-pin-hover.png" alt=""/> <!-- preload hover img -->
                             
                <!-- Map -->
                <div id="map"></div>

                <!-- Map js -->
                <script type="text/javascript" src="resources/js/map.js"></script>
                <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUFqUfsRLDfd4kVe4wYkACPu9Aswm0AT0&amp;callback=initialize" async="async" defer="defer"></script>
            
                <!-- Add pin dialog -->
                <div id="create-pin-dialog" title="Create a Pin">
                    <h:form id="create-pin-form" enctype="multipart/form-data">
                        <!-- Create pin form -->
                        <div id="create-pin-fields-wrapper">
                            <!-- Validator -->
                            <f:event listener="#{accountManager.validateInformation}" type="postValidate"/>
                            <!-- Fields -->
                            <h:inputText id="title" class="input-control #{component.valid?'':'validation-failed'}" 
                                         value="#{pinManager.pinTitle}" a:placeholder="Pin Title*"
                                         required="true" />
                            <h:inputTextarea id="description" class="input-control #{component.valid?'':'validation-failed'}"
                                             value="#{pinManager.pinDescription}" a:placeholder="Pin Description*"
                                             required="true" />
                            Upload a photo (optional):
                            <p:fileUpload id="browse-btn" mode="simple" />
                            <p:selectBooleanCheckbox value="#{pinManager.pinAnonymous}"> Make anonymous
                            </p:selectBooleanCheckbox>
                            <!-- Contains the browser's current location as "[lat] [long]". 
                            Populated on window load. See window.onload() in map.js.-->
                            <h:inputHidden id="pinDataHiddenContainer" value="#{pinManager.locationData}" />
                        </div>
                        <!-- Divider -->
                        <hr style="margin: 15px 0 15px 0" />
                        <!-- Upload / close button -->
                        <h:commandButton id="cancel-btn" class="btn" value="Cancel" 
                                         onclick="closeDialog()">
                            <f:ajax execute="@form" render="@form"/>
                        </h:commandButton>
                        <h:commandButton id="create-btn" class="btn" value="Create Pin" 
                                         action="#{pinManager.createPin(accountManager.selected)}" onclick="closeDialog()">
                            <f:ajax execute="@form" render="@form"/>
                        </h:commandButton>
                    </h:form>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
